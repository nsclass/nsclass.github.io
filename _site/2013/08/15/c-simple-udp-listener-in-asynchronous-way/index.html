<p>[code lang="c"]<br />
private Socket udpSock;<br />
private byte[] buffer;<br />
public void Starter(){<br />
    //Setup the socket and message buffer<br />
    udpSock = new Socket(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);<br />
    udpSock.Bind(new IPEndPoint(IPAddress.Any, 12345));<br />
    buffer = new byte[1024];</p>
<p>    //Start listening for a new message.<br />
    EndPoint newClientEP = new IPEndPoint(IPAddress.Any, 0);<br />
    udpSock.BeginReceiveFrom(buffer, 0, buffer.Length, SocketFlags.None, ref newClientEP, DoReceiveFrom, udpSock);<br />
}</p>
<p>private void DoReceiveFrom(IAsyncResult iar){<br />
    try{<br />
        //Get the received message.<br />
        Socket recvSock = (Socket)iar.AsyncState;<br />
        EndPoint clientEP = new IPEndPoint(IPAddress.Any, 0);<br />
        int msgLen = recvSock.EndReceiveFrom(iar, ref clientEP);<br />
        byte[] localMsg = new byte[msgLen];<br />
        Array.Copy(buffer, localMsg, msgLen);</p>
<p>        //Start listening for a new message.<br />
        EndPoint newClientEP = new IPEndPoint(IPAddress.Any, 0);<br />
        udpSock.BeginReceiveFrom(buffer, 0, buffer.Length, SocketFlags.None, ref newClientEP, DoReceiveFrom, udpSock);</p>
<p>        //Handle the received message<br />
        Console.WriteLine(&quot;Recieved {0} bytes from {1}:{2}&quot;,<br />
                          msgLen,<br />
                          ((IPEndPoint)clientEP).Address,<br />
                          ((IPEndPoint)clientEP).Port);<br />
        //Do other, more interesting, things with the received message.<br />
    } catch (ObjectDisposedException){<br />
        //expected termination exception on a closed socket.<br />
        // ...I'm open to suggestions on a better way of doing this.<br />
    }<br />
}<br />
[/code]</p>
